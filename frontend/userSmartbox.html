<h2>User Smartbox</h2>
<div id="showSmartbox"></div>
<div id="createGroupContent">
    <h3>Create a new group:</h3>
    <form method='post' onsubmit='createGroup()'>
        <label>Group Name: </label><input id='inputGroupName' type='text' required><br>
        <label>Description: </label><input id='inputGroupDesc' type='text' required><br>
        <input type='submit' value='create'></form>
</div>
<div id="assignGroupContent">
    <h3>Assign Smartbox and pin to a group:</h3>
    <form method='post' onsubmit='assignSbAndPinToGroup()' id="sbAndPinToGroup">
        <label>Choose available group: </label><select id='availableNewGroupList' onchange="showAvailablePins()"
                                                       required></select><br>
        <label>Choose smartbox: </label><select id='availableSbList' onchange='showAvailablePins()'
                                                required></select><br>
        <label>Choose available Pin: <select id='availblePins' required></select></label><br>
        <input type='submit' value='assign'><br>
        <label id="pinResponse" style="color: red"></label>
    </form>
</div>
<script>
    $(document).ready(function () {          //when document is ready

        $.ajax({
            url: "./backend/showSmartboxTable.php",     //makes post request to the url
            method: "POST",
            data: {su: 1},
            success: function (data) {      //on success display table for the specific user
                $("#showSmartbox").html(data);
            }
        }); //shows the smartbox Tables

        $.ajax({
            url: "./backend/showAvailableGroup.php",     //makes post request to the url
            method: "POST",
            data: {showGroup: 1},
            success: function (data) {      //on success display table for the specific user
                if (data === "error") {
                    $("#sbAndPinToGroup").html("No groups available. Please create a new Group.");
                } else {
                    $("#availableNewGroupList").html(data);
                }
            }
        }); //shows unassigned Groups

        $.ajax({
            url: "./backend/showAvailableSb.php",     //makes post request to the url
            method: "POST",
            data: {showAvailableSb: 1},
            success: function (data) {      //on success display table for the specific user
                if (data === "error") {
                    $("#sbAndPinToGroup").html("No Smartbox Available.");
                } else {
                    $("#availableSbList").html(data);
                    showAvailablePins();
                }
            }
        }); //shows available smartboxes

    });

    function showAvailablePins() {
        let hostname = $("#availableSbList").val();
        //let group = $("#availableNewGroupList").val();

        $.ajax({
            url: "./backend/showAvailablePins.php",     //makes post request to the url
            method: "POST",
            data: {avPin: 1, hostname: hostname},
            success: function (data) {      //on success display table for the specific user
                if (data === "error") {
                    $("#pinResponse").html("No pins for " + hostname + " available. Contact Technician");
                } else {
                    $("#pinResponse").html("<label id='pinResponse' style='color: red'></label>");
                }
                $("#availblePins").html(data);
            }
        }); //shows avaialble pins
    }

    function showGroups(hostname) { // shows available groups from selected hostname
        $.ajax({
            url: "./backend/showSmartboxGroup.php",     //makes post request to the url
            method: "POST",
            data: {smGr: 1, hostname: hostname},
            success: function (data) {      //on success display table for the specific user
                if (data === "error") {
                    $("#groupsContent").html("<p style='color: red'>There are no groups assign for the selected smartbox. Please assign an existent group to "+hostname+"</p>");
                } else {
                    $("#groupsContent").html(data);
                }
            }
        });
    }

    function removePinFromGroup(Pin, Group, hostname) {  //remove selected pins from selected group
        let confirm = prompt("Are you sure you want to remove it?\nType 'Remove' to confirm it:");
        if (confirm === "Remove") {
            $.ajax({
                url: "/backend/removePinFromGroup.php",   //sends data over post request
                method: "POST",
                data: {removePin: 1, pinNr: Pin, group: Group, hostname: hostname},
                success: function (data) {      //on success remove pin from group and reloads page
                    alert(data);
                    location.reload();
                }
            });
        } else {
            alert("Remove got cancelled");
        }
    }

    function showAddPinToGroup(groupNr, hostname) { //show selectbox of output pins to add it on selected Group
        $.ajax({
            url: "./backend/showAvailablePins.php",     //makes post request to the url
            method: "POST",
            data: {avPin: 1, hostname: hostname},
            success: function (data) {      //on success display table for the specific user
                $("#addOutput").html("<h4>Add new pin to the Group " + groupNr + ":</h4><select id='availablePins'>" + data + "</select><button onclick=addPinToGroup(" + groupNr + ",'" + hostname + "')>Add Pin to Group</button>");
            }
        });
    }

    function addPinToGroup(groupNr, hostname) {   //add the selected available pin to the group
        let pin = $("#availablePins").val();
        $.ajax({
            url: "./backend/addPinsToGroup.php",     //makes post request to the url
            method: "POST",
            data: {addPin2Group: 1, groupNr: groupNr, pin: pin, hostname: hostname},
            success: function (data) {      //on success display table for the specific user
                alert(data);
                location.reload();
            }
        });
    }

    function deleteGroup(GroupNr) {     //delete group from selected group id
        let confirm = prompt("Are you sure you want to delete it?\nType 'Delete' to confirm it:");
        if (confirm === "Delete") {
            $.ajax({
                url: "/backend/deleteGroup.php",   //sends data over post request
                method: "POST",
                data: {deleteGroup: 1, groupNr: GroupNr},
                success: function (data) {      //on success deletes group and reloads page
                    alert(data);
                    location.reload();
                }
            });
        } else {
            alert("Delete got cancelled");
        }
    }

    function createGroup() {  //create a new group to add pins in
        let groupName = $("#inputGroupName").val();
        let groupDesc = $("#inputGroupDesc").val();

        $.ajax({
            url: "./backend/createGroup.php",     //makes post request to the url
            method: "POST",
            data: {createGroup: 1, groupName: groupName, groupDesc: groupDesc},
            success: function (data) {      //on success display data
                alert(data);
                location.reload();
            }
        });

    }

    function assignSbAndPinToGroup() {
        let hostname = $("#availableSbList").val();
        let group = $("#availableNewGroupList").val();
        let pin = $("#availblePins").val();

        $.ajax({
            url: "./backend/assignAllToGroup.php",     //makes post request to the url
            method: "POST",
            data: {assignToGroup: 1, hostname: hostname, group: group, pin: pin},
            success: function (data) {      //on success display data
                alert(data);
            }
        });
    }

    function checkAffects(hostname) {    // checks if selected smartbox have assigned Groups
        $.ajax({
            url: "./backend/showSmartboxGroup.php",     //makes post request to the url
            method: "POST",
            data: {smGr: 1, hostname: hostname},
            success: function (data) {      //on success display table for the specific user
                if (data === "error") {
                    $("#groupsContent").html("<p style='color: red'>There are no groups assign for the selected smartbox. Please assign an existent group to " +hostname+"</p>");
                } else {
                    showEvents(hostname); //on success, it triggers the function
                }
            }
        });
    }

    function showEvents(hostname) { //Display Events when Group Affect isset
        $.ajax({
            url: "./backend/showEvents.php",     //makes post request to the url
            method: "POST",
            data: {showEvent: 1, hostname: hostname},
            success: function (data) {      //on success display events for the specific SB
                $("#groupsContent").html(data);
                $("#groupsContent").append("<h3>Create a new event:</h3>" +
                    "<form id='createEventForm' method='post' onsubmit=eventCreate('"+hostname+"')>" +
                    "<label>Event Code: </label><input id='eventCode' type='text' maxlength='1' required><br>" +
                    "<label>Description: </label><input id='eventDesc' type='text' required><br>" +
                    "<label>Chose available Pin: </label><select required id='eventPin'></select><br>" +
                    "<input type='submit' value='Create'>"+
                    "</form>");
                showAvailableInputPins(hostname);
            }
        });
    }

    function eventCreate(hostname){
        let eventCode = $("#eventCode").val().toUpperCase();
        let eventDesc= $("#eventDesc").val();
        let eventPin= $("#eventPin").val();

        $.ajax({
            url: "./backend/createEvent.php",     //makes post request to the url
            method: "POST",
            data: {createEvent: 1, hostname: hostname, eventCode: eventCode, eventDesc: eventDesc, eventPin: eventPin},
            success: function (data) {      //on success displays create new event
                alert(data)
            }
        });

    }

    function showAvailableInputPins(hostname){ //show available input pins from selected SB
        $.ajax({
            url: "./backend/showAvailableInputPins.php",     //makes post request to the url
            method: "POST",
            data: {showInputPins: 1, hostname: hostname},
            success: function (data) {      //on success displays pins
                if (data === "error"){
                    $("#createEventForm").html("<p style='color: red'>There are no input Pins available for "+hostname+". Please contact Technician</p>");
                } else {
                    $("#eventPin").html(data);
                }
            }
        });
    }

    function editGroup(groupNr){    //displays form to edit Group
        $.ajax({
            url: "./backend/showGroupEdit.php",     //makes post request to the url
            method: "POST",
            data: {showGroupEdit: 1, groupNr: groupNr},
            success: function (data) {      //on success displays edit GrouÃ©
                $("#group"+groupNr).html(data);
            }
        });

    }

    function updateGroup(groupNr){  //update group information
        let groupName= $("#inputGroupName"+groupNr).val();
        let groupDesc= $("#inputGroupDesc"+groupNr).val();
        if (groupName.length > 0 && groupDesc.length > 0){
            $.ajax({
                url: "./backend/updateGroup.php",     //makes post request to the url
                method: "POST",
                data: {updateGroup: 1, groupNr: groupNr, groupName: groupName, groupDesc: groupDesc},
                success: function (data) {      //on success displays message
                    alert(data);
                    location.reload();
                }
            });
        } else {
            alert("Values are empty");
        }

    }

    function showEditEvent(eventCode,hostname, pinNr){  //displays form to edit Events
        $.ajax({
            url: "./backend/showEditEvent.php",     //makes post request to the url
            method: "POST",
            data: {showEditEvent: 1, eventCode: eventCode, hostname: hostname, pinNr: pinNr},
            success: function (data) {      //on success displays edit events
                $("#editEvent").html(data);
            }
        });
    }

    function updateEvent(eventCode, hostname, pinNr){   //update group information
        let code= $("#inputEventCode"+eventCode+hostname+pinNr).val().toUpperCase();
        let eventDesc= $("#inputEventDesc"+eventCode+hostname+pinNr).val();

        if (code.length > 0 && eventDesc.length > 0) {
            $.ajax({
                url: "./backend/updateEvent.php",     //makes post request to the url
                method: "POST",
                data: {updateEvent: 1, code: code, eventDesc: eventDesc, hostname: hostname, pinNr: pinNr},
                success: function (data) {      //on success displays message
                    alert(data);
                    location.reload();
                }
            });
        } else{
            alert("Values are empty");
        }
    }

    function deleteEvent(eventCode, hostname, pinNr){   //delete event from selected event code, hostname and pin
        let confirm = prompt("Are you sure you want to delete it?\nType 'Delete' to confirm it:");
        if (confirm === "Delete") {
            $.ajax({
                url: "/backend/deleteEvent.php",   //sends data over post request
                method: "POST",
                data: {deleteEvent: 1, eventCode: eventCode, hostname: hostname, pinNr: pinNr},
                success: function (data) {      //on success deletes group and reloads page
                    alert(data);
                    location.reload();
                }
            });
        }else {
            alert("Delete got cancelled");
        }
    }

    function showExecuteSwitch(hostname){ //display table of Switches
        $.ajax({
            url: "./backend/showSwitchTable.php",     //makes post request to the url
            method: "POST",
            data: {showSwitchTable: 1, hostname: hostname},
            success: function (data) {      //on success displays edit events
                $("#groupsContent").html(data);
                if (data === "error"){
                    $("#groupsContent").html("<p style='color: red'>No switches assigned for "+ hostname+"</p>");
                }else {
                    $("#groupsContent").html(data);
                }
                $("#groupsContent").append("<h3>Assign event and group to switch:</h3>");
                showAssignedSwitch(hostname);

            }
        });
    }

    function showAssignedSwitch(hostname){
        $.ajax({
            url: "./backend/showAssignSwitch.php",     //makes post request to the url
            method: "POST",
            data: {showAssignSwitch: 1, hostname: hostname},
            success: function (data) {      //on success displays edit events
               if(data === "exist"){
                   $("#groupsContent").append("<form id='switchAssignment' method='post' onsubmit=assignExecuteSwitch('"+hostname+"')><label>Function Code: </label>" +
                       "<select id='assignFuncCode' required><option value='A'>A</option><option value='E'>E</option><option value='U'>U</option></select><br>" +
                       "<label>Description: </label><input type='text' id='assignDesc' required><br>" +
                       "<label>Sequence number: </label><input id='assignSeq' type='number'><br>" +
                       "<label>Delay: </label><input type='number' id='assignDelay'><br>" +
                       "<label>Event Code: </label><select id='assignEventCode' onchange=showPinsAvailableEvent('"+hostname+"') required></select><br>" +
                       "<label>Pin number: </label><select id='assignPinNr' required></select><br>" +
                       "<label>Group number: </label><select id='assignGroupNr' required></select><br>" +
                       "<input type='submit' value='Assign'>" +
                       "</form>");

                        showGroupNumber(hostname);
                        showAvailableEventCode(hostname);
               }else {
                   $("#groupsContent").append("<p style='color: red'>Event or group is not assign to "+hostname+". Please verify it.</p>");
               }
            }
        });
    }

    function assignExecuteSwitch(hostname){     //assign values to the list of switches
        let assignFuncCode= $("#assignFuncCode").val();
        let assignDesc= $("#assignDesc").val();
        let assignSeq= $("#assignSeq").val();
        let assignDelay= $("#assignDelay").val();
        let assignEventCode= $("#assignEventCode").val();
        let assignPinNr= $("#assignPinNr").val();
        let assignGroupNr= $("#assignGroupNr").val();


        if (assignFuncCode === "A" || assignFuncCode === "E" || assignFuncCode === "U" ){
            $.ajax({
                url: "./backend/assignExecuteSwitch.php",   //sends data over post request
                method: "POST",
                data: {assignExecuteSwitch: 1, assignFuncCode: assignFuncCode, assignDesc: assignDesc, assignSeq: assignSeq, assignDelay: assignDelay, assignEventCode: assignEventCode, assignPinNr: assignPinNr, hostname: hostname, assignGroupNr: assignGroupNr},
                success: function (data) {      //on success display values
                    alert(data);
                }
            });
        }
    }

    function showAvailableEventCode(hostname){      //show available event codes
        $.ajax({
            url: "./backend/showAvailableEventCode.php",   //sends data over post request
            method: "POST",
            data: {showAvailableEventCode: 1, hostname: hostname},
            success: function (data) {      //on success display values
                if (data==="error"){
                    $("#switchAssignment").html("<p style='color: red'>There are no event codes available.</p>");
                } else{
                    $("#assignEventCode").html(data);
                    showPinsAvailableEvent(hostname);
                }
            }
        });
    }

    function showGroupNumber(hostname){
        $.ajax({
            url: "./backend/showAvailableGroupNumber.php",   //sends data over post request
            method: "POST",
            data: {showAvailableGroupNumber: 1, hostname: hostname},
            success: function (data) {      //on success display values
                if (data==="error"){
                    $("#switchAssignment").html("<p style='color: red'>There are no group available.</p>");
                } else{
                    $("#assignGroupNr").html(data);
                }
            }
        });
    }

    function showPinsAvailableEvent(hostname){      //show available Pins from event code
        let eventCode= $("#assignEventCode").val();

        $.ajax({
            url: "./backend/showAvailableEventPins.php",   //sends data over post request
            method: "POST",
            data: {showAvailableEventPins: 1, hostname: hostname, eventCode: eventCode},
            success: function (data) {      //on success display values
                if (data==="error"){
                    $("#assignPinNr").html("<p style='color: red'>There are no Pins available.</p>");
                } else{
                    $("#assignPinNr").html(data);
                }
            }
        });
    }

    function showSwitchEdit(functionsCode, hostname, eventCode, pinNr, groupNr){
        $.ajax({
            url: "./backend/showSwitchEdit.php",     //makes post request to the url
            method: "POST",
            data: {showSwitchEdit: 1, functionsCode: functionsCode, hostname: hostname, eventCode: eventCode, pinNr: pinNr, groupNr: groupNr},
            success: function (data) {      //on success displays edit events
               $("#switchEditContent").html(data);
            }
        });
    }

    function updateSwitch(functionsCode, hostname, eventCode, pinNr, groupNr){
        let editSwitchDesc= $("#editSwitchDesc").val();
        let editSwitchSeq= $("#editSwitchSeq").val();
        let editSwitchDelay= $("#editSwitchDelay").val();

        $.ajax({
            url: "./backend/updateSwitch.php",     //makes post request to the url
            method: "POST",
            data: {switchUpdate: 1, editSwitchDesc: editSwitchDesc, editSwitchSeq: editSwitchSeq, editSwitchDelay: editSwitchDelay, functionsCode: functionsCode, hostname: hostname, eventCode: eventCode, pinNr: pinNr, groupNr: groupNr},
            success: function (data) {      //on success displays message
                alert(data);
                location.reload();
            }
        });
    }

    function deleteSwitch(functionsCode, hostname, eventCode, pinNr, groupNr){
        let confirm = prompt("Are you sure you want to delete it?\nType 'Delete' to confirm it:");
        if (confirm === "Delete") {
            $.ajax({
                url: "/backend/deleteSwitch.php",   //sends data over post request
                method: "POST",
                data: {deleteSwitch: 1, functionsCode: functionsCode, hostname: hostname, eventCode: eventCode, pinNr: pinNr, groupNr: groupNr},
                success: function (data) {      //on success deletes group and reloads page
                    alert(data);
                    location.reload();
                }
            });
        }else {
            alert("Delete got cancelled");
        }
    }

</script>